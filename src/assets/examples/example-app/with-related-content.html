<html>
  <head>
    <style>
      body {
        font-family: 'Arial', 'Helvetica', 'sans-serif'
      }
      div {
        margin: 10px 0;
      }
      h3 {
        margin: 0 0 5px 0;
      }
      textarea {
        width: 100%;
        height: 200px;
      }
      #buttons {
        margin-top: 10px;
      }
    </style>
    <script type="text/javascript">
      var mainContentID = "mainContent",
          firstRelatedContentName = "first related content",
          firstRelatedContentID = "relatedContent1",
          secondRelatedContentName = "second related content",
          secondRelatedContentID = "relatedContent2",
          cfmClient, cfmContent;

      function newFile() {
        cfmClient && cfmClient.newFileDialog();
      }

      function openFile() {
        // no callback for open - we will handle it in the clientInit event callback
        cfmClient && cfmClient.openFileDialog();
      }

      function saveFile() {
        cfmClient && cfmClient.save();
      }

      function saveFileAs() {
        cfmClient && cfmClient.saveFileAsDialog(getContent());
      }

      function getContent() {
        cfmContent.setText(getText(mainContentID));
        cfmContent.setRelatedContent(firstRelatedContentName, getText(firstRelatedContentID));
        cfmContent.setRelatedContent(secondRelatedContentName, getText(secondRelatedContentID));
        return cfmContent;
      }

      function setContent(_cfmContent) {
        cfmContent = _cfmContent;
        setText(mainContentID, cfmContent.getText());
        setText(firstRelatedContentID, cfmContent.getRelatedContent(firstRelatedContentName) ? cfmContent.getRelatedContent(firstRelatedContentName).getText() : "");
        setText(secondRelatedContentID, cfmContent.getRelatedContent(secondRelatedContentName) ? cfmContent.getRelatedContent(secondRelatedContentName).getText() : "");
      }

      function connected(client) {
        cfmClient = client;
        cfmContent = client.createTextContent(getText(mainContentID));
        cfmContent.initRelatedContent(firstRelatedContentName, getText(firstRelatedContentID));
        cfmContent.initRelatedContent(secondRelatedContentName, getText(secondRelatedContentID));
      }

      function changed() {
        cfmClient && cfmClient.dirty();
      }

      function focus() {
        document.getElementById(mainContentID).focus();
      }

      function getText(id) {
        return document.getElementById(id).value;
      }
      function setText(id, text) {
        document.getElementById(id).value = text;
      }

    </script>
  </head>
  <body>
    <h2>Demo App</h2>
    <p>
      This simple demo app uses the textarea below to edit text files.  You can either use the menu bar or the buttons below to open, save and create new files.
    </p>
    <div>
      <h3>Main Content</h3>
      <textarea id="mainContent" onkeyup="changed()"></textarea>
    </div>
    <div>
      <h3>First Related Content File</h3>
      <textarea id="relatedContent1" onkeyup="changed()"></textarea>
    </div>
    <div>
      <h3>Second Related Content File</h3>
      <textarea id="relatedContent2" onkeyup="changed()"></textarea>
    </div>
    <div id="buttons">
      <button onclick="newFile()">New</button>
      <button onclick="openFile()">Open</button>
      <button onclick="saveFile()">Save</button>
      <button onclick="saveFileAs()">Save As</button>
    </div>
    <script type="text/javascript">
      var cfm = parent && parent.CloudFileManager ? parent.CloudFileManager : null,
          clientOptions;

      if (cfm) {
        cfm.clientConnect(function (event) {
          console.log(event);
          switch (event.type) {
            case 'connected':
              var client = event.data.client;
              connected(client);
              client.appendMenuItem({
                name: 'Inner Frame Callback Menu Item',
                action: function () { alert('This is an example of a callback menu item added in the inner frame')}
              });
              //client.setMenuBarInfo('Version 0.0.1');
              break;

            case 'getContent':
              event.callback(getContent());
              break;

            case 'newedFile':
            case 'openedFile':
              setContent(event.data.content);
              focus();
              break;
          }
        });
      }

      focus()
    </script>
  </body>
</html>
